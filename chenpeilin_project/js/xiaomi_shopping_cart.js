"use strict";jQuery(function(_){var p="<div class='xiaomi_rabbit'>  \n                    <i></i>\n                    <div class=\"xiaomi_rabbit_right\">\n                        <h1>您的购物车还是空的!</h1>\n                        <span>马上去购物</span>\n                    </div>\n                </div>",e=decodeURI(location.search);e=e.slice(1),console.log(e),_.ajax({url:"../api/xiaomi_shopping_cart.php",type:"POST",data:{a:"cartrender"},async:!0,success:function(e){if($res=_.parseJSON(e),console.log($res),$cart_length=_.parseJSON(e).length,0<$cart_length){var n=' <div class="list_header">\n                                            <div class="col_checked header_col">\n                                                 <input type="checkbox" id="selectall" />\n                                                 全选\n                                            </div>\n                                            <div class="col_img header_col col_delete_all" style=\'cursor:pointer;text-decoration:underline;\'>\n                                                删除选中\n                                            </div>\n                                            <div class="col_listname header_col">商品名称</div>\n                                            <div class="col_price header_col">单价</div>\n                                            <div class="col_num header_col">数量</div>\n                                            <div class="col_total header_col">小计</div>\n                                            <div class="col_operate header_col">操作</div>\n                                        </div>\n                                        <div class="list_body">\n                                            <div class=\'item_box\'> \n                                    ';n+=$res.map(function(e){return'         \n                                <div class="item_box_list_information" data-id=\''+e.cid+'\'>\n\n                                    <div class="current_list_checkbox current_col">\n                                        <input type="checkbox" />\n                                    </div>\n\n                                    <div class="current_list_img current_col">\n                                        <img src="'+e.describe_img+'" alt="" />\n                                    </div>\n\n                                    <div class="current_list_version_information current_col">\n                                        '+e.listname+" "+_.parseJSON(e.version_information)[2]+" "+_.parseJSON(e.version_information)[0]+" 内存 "+_.parseJSON(e.version_information)[1]+" "+e.color+'\n                                    </div>\n\n                                    <div class="current_list_price current_col">\n                                        <span>'+e.present_price+'</span>元\n                                    </div>\n\n                                    <div class="current_list_num current_col">\n                                        <div class="add_delete">\n                                        <span id=\'deletepiece\' class=\'current_piece\'>-</span>\n                                        <input type="text" value="'+e.buyofnum+"\" />\n                                        <span id='addpiece'  class='current_piece'>+</span>\n                                        </div>\n                                        <div class=\"maxnum_of_buy\">\n                                        还可买 <span>"+(e.maxnumber-e.buyofnum)+'</span> 件\n                                        </div>\n                                    </div>\n\n                                    <div class="current_list_subtotal current_col">\n                                        <span>'+e.present_price*e.buyofnum+'</span>元\n                                    </div>\n\n                                    <div class="current_list_cancel current_col">\n                                         &times;\n                                    </div>\n                                </div>               \n                                    '}).join(""),n+="</div>\n                                    </div>\n                                    <div class=\"list_footer\">\n                                        <span class='continue_shop footer_col'>继续购物</span>\n                                        <p  class='footer_col footer_piece'>\n                                            共\n\n                                            <span class='allpiece'>\n                                                0\n                                            </span>\n\n                                            件商品,已选择\n\n                                            <span class='selectpiece'>\n                                                0\n                                            </span>\n                                            件\n                                        </p>\n                                        <p class='footer_col account'>去结算\n                                        </p>\n                                        <p class='list_total footer_col'>\n                                            合计:<span>0</span>元\n                                        </p>     \n                                    </div> ",_("#my_shopping_cart .container").html(n);for(var t=0;t<$res.length;t++)console.log(66677778888999),1*_(".add_delete input").eq(t).val()==1*$res[t].maxnumber&&_(".maxnum_of_buy").eq(t).html("已到最大购买量")}else 0==$cart_length&&_("#my_shopping_cart .container").html(p);function i(){for(var e=0;e<_(".add_delete").find("input").length;e++)1<_(".add_delete").find("input").eq(e).val()?_(".add_delete").eq(e).next().css("display","block"):_(".add_delete").find("input").eq(e).val()<=1&&_(".add_delete").eq(e).next().css("display","none")}i(),l(),_(".current_piece").click(function(){var e=_(this).parents(".item_box_list_information").attr("data-id"),t="";"addpiece"==_(this).attr("id")?t=1:"deletepiece"==_(this).attr("id")&&(t=0),$thisinput=_(this).parent().find("input"),$thislimit=_(this).parent().next(),$this=_(this),_.ajax({url:"../api/xiaomi_shopping_cart.php",type:"POST",data:{a:"addordelete",pieceid:e,choose:t},async:!0,success:function(e){var n;$res=_.parseJSON(e),console.log($res),$thisinput.val($res.buy_num),$thislimit.html("还可买<span style='font-size:12px;'>"+$res.updatenum+"</span>件"),$thisinput.val()==$res.max_num&&$thislimit.html("<span style='font-size:12px;'>"+$res.updatenum+"</span>"),0==t&&$thisinput.val()==$res.min_num?$this.css("background","#ccc"):1==t&&$thisinput.val()==$res.max_num?$this.css("background","#ccc"):_(".current_piece").css("background",""),i(),n=$this,$sub_total=n.parents(".item_box_list_information").find(".current_list_price span").html()*n.parents(".item_box_list_information").find(".add_delete input").val(),n.parents(".item_box_list_information").find(".current_list_subtotal span").html($sub_total),o(),c(),l()},error:function(e){console.log(e)}})}),_(".col_delete_all").click(function(){for(var e=[],n=0;n<_(".current_list_checkbox input").length;n++)if(_(".current_list_checkbox input").eq(n).prop("checked")){var t=_(".current_list_checkbox input").eq(n).parents(".item_box_list_information").attr("data-id");e.push(t)}console.log(123456,e);var i=JSON.stringify(e);console.log(i),_.ajax({url:"../api/xiaomi_shopping_cart.php",type:"POST",data:{a:"delete_part",delete_list_part:i},async:!0,success:function(e){if($res=_.parseJSON(e),console.log($res),0==$res.present_length)_("#my_shopping_cart .container").html(p);else if(0<$res.present_length)for(var n=s.length-1;0<=n;n--)_(".current_list_checkbox input").eq(s[n]).parents(".item_box_list_information").remove();o(),c(),l()},error:function(e){console.log(e)}})}),_(".current_list_cancel").click(function(){$thislistid=_(this).parents(".item_box_list_information").attr("data-id"),console.log($thislistid),$this=_(this),console.log($this),_.ajax({url:"../api/xiaomi_shopping_cart.php",type:"POST",data:{a:"delete_current_list",delete_list:$thislistid},async:!0,success:function(e){$this.parents(".item_box_list_information").remove(),console.log(e,$cart_length),$res=_.parseJSON(e),0==$res.present_length?_("#my_shopping_cart .container").html(p):0<$res.present_length&&alert($res.delete_status),o(),c(),l()},error:function(e){console.log(e)}})}),_("#selectall").click(function(){_("#selectall").prop("checked")?_(".current_list_checkbox input").prop("checked","checked"):_(".current_list_checkbox input").prop("checked",!1),o(),c()}),_(".current_list_checkbox input").click(function(){o(),console.log(6666666666),o(),c()});var s=[];function o(){s=[];for(var e=0;e<_(".current_list_checkbox input").length;e++)_(".current_list_checkbox input").eq(e).prop("checked")&&s.push(e);console.log(s),s.length==_(".current_list_checkbox input").length?_("#selectall").prop("checked","checked"):_("#selectall").prop("checked",!1)}function c(){for(var e=0,n=0,t=0;t<s.length;t++)e+=1*_(".current_list_checkbox input").eq(s[t]).parents(".item_box_list_information").find(".current_list_subtotal span").html(),n+=1*_(".current_list_checkbox input").eq(s[t]).parents(".item_box_list_information").find(".add_delete input").val();_(".list_total span").html(e),_(".selectpiece").html(n)}function l(){for(var e=0,n=0;n<_(".current_list_checkbox input").length;n++)e+=1*_(".current_list_checkbox input").eq(n).parents(".item_box_list_information").find(".add_delete input").val();_(".allpiece").html(e)}_(".xiaomi_rabbit_right span").click(function(){location.href="../xiaomiindex.html"}),_("#unamestatus").click(function(){Cookie.setCookie("cartaddr","xiaomi_shopping_cart.html",{path:"/"}),location.href="xiaomi_login.html"});var a=decodeURI(Cookie.getCookie("uid")),r=decodeURI(Cookie.getCookie("username"));"undefined"!=a&&(_("#unamestatus").unbind("click"),_("#unamestatus").html(r),_(".statustwo").html("我的订单"),_(".pul").mouseover(function(){_(".loginul").css("display","block"),_(".loginul i").css("display","block"),_(".loginul i").css("display","block"),_(".loginul").css({background:"#fff"}),_(".loginul span").css({color:"#FF6700","border-color":"#fff"}),_(".loginul").mouseover(function(){_(".loginul").css("display","block")})}),_(".pul").mouseout(function(){_(".loginul").css("display","none"),_(".loginul i").css("display","none"),_(".loginul").css("background",""),_(".loginul span").css({color:"","border-color":""}),_(".loginul").mouseout(function(){_(".loginul").css("display","none")})})),_("#login_out").click(function(){_("#unamestatus").bind("click"),_("#unamestatus").html("登录"),_(".statustwo").html("注册"),Cookie.removeCookie("uid"),Cookie.removeCookie("username"),_("#my_shopping_cart .container").html(p)})},error:function(e){console.log(e)}})});